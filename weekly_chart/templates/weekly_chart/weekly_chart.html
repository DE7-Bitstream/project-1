{% extends "layout.html" %}
{% load static %}

{% block content %}
    <h1>주간 차트 추이</h1>
    <div class="melon-chart">
        <h3>{{ start_year }}년 {{ start_month }}월 ~ {{ end_year }}년 {{ end_month }}월 (Top {{ max_rank }})</h3>

        <!-- 캔버스 -->
        <div class="chart-container" style="margin: 0 auto;">
            <canvas id="weeklyChart"></canvas>
        </div>


        <!-- Form -->
        <div style="margin: 20px auto;">
            <form method="get" action="{% url 'weekly_chart' %}" id="filterForm">
                <!-- 시작 연도/월 -->
                <label>시작 연도:</label>
                <select name="start_year" id="start_year">
                    {% for y in year_list %}
                        <option value="{{ y }}" {% if start_year == y %}selected{% endif %}>{{ y }}</option>
                    {% endfor %}
                </select>
                <label>시작 월:</label>
                <select name="start_month" id="start_month">
                    {% for m in month_list %}
                        <option value="{{ m }}" {% if start_month == m %}selected{% endif %}>{{ m }}월</option>
                    {% endfor %}
                </select>

                <!-- 끝 연도/월 -->
                <label>끝 연도:</label>
                <select name="end_year" id="end_year">
                    {% for y in year_list %}
                        <option value="{{ y }}" {% if end_year == y %}selected{% endif %}>{{ y }}</option>
                    {% endfor %}
                </select>
                <label>끝 월:</label>
                <select name="end_month" id="end_month">
                    {% for m in month_list %}
                        <option value="{{ m }}" {% if end_month == m %}selected{% endif %}>{{ m }}월</option>
                    {% endfor %}
                </select>

                <!-- 최대 순위 -->
                <label>최대 순위:</label>
                <input type="number" name="max_rank" id="max_rank" value="{{ max_rank }}" min="1" max="30">

                <button type="submit">조회</button>
            </form>

            <!-- 전체 그래프 토글용 -->
            <div style="max-width: 800px; margin: 10px auto;">
                <button type="button" id="toggleAllBtn">전체 그래프 토글</button>
            </div>

        </div>
    </div>

    <div class="weekly-comment">
        <h3>그래프 해석 및 주의사항</h3>
        <ul>
            <li>이 그래프는 Melon 주간 차트 데이터를 기반으로 합니다.</li>
            <li>각 곡의 순위 변동을 시각적으로 확인할 수 있습니다.</li>
            <li>최대 순위 설정은 1에서 30 사이로 제한됩니다. (기본값: 10)</li>
            <li>시작 월과 끝 월은 최대 12개월 이내로 설정해야 합니다.</li>
            <li>특정 곡의 그래프에 마우스 오버하면 해당 곡의 그래프가 강조 표시됩니다. 마우스 클릭하면 해당 곡을 숨길 수 있습니다.</li>
            <li>범례에서 곡명을 클릭하면 해당 곡의 그래프를 개별적으로 표시하거나 숨길 수 있습니다.</li>
            <li>"전체 그래프 토글" 버튼을 클릭하면 모든 곡의 선이 한 번에 표시되거나 숨겨집니다.</li>
        </ul>
    </div>

    <!------------------------------------>
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'weekly_chart/css/style.css' %}">

    <!-- js -->
    {{ song_data|json_script:"song-data" }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'weekly_chart/js/weekly_chart.js' %}"></script>
{% endblock %}
